## Doris 介绍

Apache Doris 是一个基于 **MPP** 架构的高性能、实时的分析性数据库，海量数据下查询结果亚秒级响应，不仅可以支持高并发的点查询场景，也能支持高吞吐的复杂分析场景

> 对高并发的点查询表示质疑，作为 OLAP 数据库对高 QPS 支持的似乎做的都不够好

## 应用场景

- 报表分析
  - 实时看板
  - 面向企业内部分析师和管理师的报表
  - 面向用户或者客户的高并发报表分析（Customer Facing Analytics）？？？
- 即席查询（Ad-hoc）
- 统一数仓：即流批一体
- 数据湖联邦查询：通过外表方式联邦分析 Hive、Iceberg、Hudi 中的数据，**避免数据拷贝**的前提下，提升查询性能

## Doris 架构

架构简单，支持横向拓展

![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mnz20ae3s23vv3e9ltmi.png)

Frontend（FE）：负责用户请求的接入、查询解析规划、元数据管理、节点管理相关工作

Backend（BE）：负责数据存储、查询计划的执行

特点：

1. 接口方面：采用 MYSQL 协议，高度兼容 MYSQL 语法，支持标准化 SQL。只要支持 MYSQL 协议的工具或 BI，Doris 都可以作为数据源提供查询支持（DDL语法存在大量不兼容现象，官方这里说的应该是查询相关的 SQL）
2. 存储引擎方面：采用列式存储，按列对数据进行编码压缩和读取
3. 索引方面：Doris 支持比较丰富的索引结构，来减少数据的扫描
   1. Sorted Compound Key Index：最多可以指定三个列组成复合排序键，能够有效进行数据裁剪
   2. Z-order Index：可以高效对数据模型中的任意字段组合进行范围查询
   3. Bloom Filter：对高基数列的等值过滤裁剪非常有效
   4. Invert Index：能够对任意字段实现快速检索
4. 存储模型方面：Doris 支持多种存储模型，针对不同的场景做针对性优化
   1. Aggregate Key 模型：相同 Key 的 Value 合并，通过提前聚合大幅提升性能（Clickhouse 中的 MergeTree 家族，前面的合并可以是 sum、count 等聚合）
   2. Unique Key 模型：Key 唯一，相同 Key 的数据进行覆盖，实现行级别的数据更新
   3. Duplicate Key 模型：明细数据模型，满足事实表的明细存储
5. 查询引擎方面：
   1. MPP 架构
   2. 支持强一致性的物化视图，物化视图的更新和选择在系统内自动进行（更新：原表数据发生变化物化视图数据实时更新，选择：当查询语法命中物化视图时自动查询物化视图数据）
   3. 向量化查询引擎
   4. 自适应查询优化**Adaptive Query Execution**，根据运行时统计信息动态调整执行计划
   5. 使用 CBO 和 RBO 结合的优化策略（CBO：基于成本优化，RBO：基于规则优化）

> 对上面部分抽象概念的解释
>
> 高基数列：正确读法是 高基数 列。即具有大量唯一值的列，当一个列包含大量不重复的值时，处理这个数据将会变得复杂和低效
>
> MPP架构：是一种分布式计算架构，用于处理大量数据和高复杂性的数据查询。多个节点并行工作以提高计算能力和数据处理速度
>
> CBO：基于成本的优化，例如：Join 时算法的选择，根据实际情况选择 Map Join 或 Hash Join 等
>
> RBO：基于规则的优化，例如：常量折叠、子查询改写、谓词下推等